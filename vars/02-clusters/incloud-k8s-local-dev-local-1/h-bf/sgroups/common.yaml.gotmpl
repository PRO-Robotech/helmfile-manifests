{{- $mainDomain := .Values.global.domains.internalSVC -}}
{{- $clusterFullName := .Values.global.clusterFullName -}}
{{- $hbfDomain  := printf "%s.%s.%s" .Release.Name .Release.Namespace $mainDomain }}

domain: {{ $mainDomain }}

appSpec:
  applications:
    web:
      containers:
        web:
          extraEnv:
            HBF_API: https://sgroups.{{ .Values.global.istioNamespace }}.{{ $mainDomain }}/server

helm-inserter:
  templates:
    VirtualService: |
      ---
      apiVersion: networking.istio.io/v1
      kind: VirtualService
      metadata:
        name: {{ .Release.Name }}
        namespace: {{ .Release.Namespace }}
      spec:
        gateways:
        - {{ .Values.global.istioNamespace }}/istio-ingressgateway
        hosts:
        - 'sgroups.{{ .Values.global.istioNamespace }}.{{ $mainDomain }}'
        http:
          - match:
              - uri:
                  prefix: /client
            name: web
            rewrite:
              uri: /client
            route:
              - destination:
                  host: {{ .Release.Name }}-web
                  port:
                    number: 80
          - match:
              - uri:
                  prefix: /server/
            name: server
            rewrite:
              uri: /
            route:
              - destination:
                  host: {{ .Release.Name }}-server
                  port:
                    number: 9006
